<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WMS - Inventory Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Toast notification component
        const Toast = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 5000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const getToastStyles = () => {
                switch (type) {
                    case 'success': return 'bg-green-500 text-white';
                    case 'error': return 'bg-red-500 text-white';
                    case 'pending': return 'bg-yellow-500 text-white';
                    case 'warning': return 'bg-orange-500 text-white';
                    default: return 'bg-blue-500 text-white';
                }
            };

            const getIcon = () => {
                switch (type) {
                    case 'success': return '✓';
                    case 'error': return '✕';
                    case 'pending': return '⏳';
                    case 'warning': return '⚠';
                    default: return 'ℹ';
                }
            };

            return (
                <div className={`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${getToastStyles()} min-w-80`}>
                    <div className="flex items-center justify-between">
                        <div className="flex items-center">
                            <span className="mr-2 font-bold">{getIcon()}</span>
                            <span>{message}</span>
                        </div>
                        <button onClick={onClose} className="ml-4 text-white hover:text-gray-200 font-bold">×</button>
                    </div>
                </div>
            );
        };

        // SKU Hierarchy Component
        const SKUHierarchy = ({ inventory }) => {
            const [expandedModels, setExpandedModels] = useState(new Set());
            const [expandedStorage, setExpandedStorage] = useState(new Set());
            const [expandedColors, setExpandedColors] = useState(new Set());

            // Build SKU hierarchy
            const buildHierarchy = () => {
                const hierarchy = {};
                
                inventory.forEach(item => {
                    const sku = item.sku || 'Unknown';
                    const skuParts = sku.split('-');
                    
                    // Parse SKU components: MODEL-STORAGE-COLOR-CARRIER
                    const model = skuParts[0] || 'Unknown';
                    const storage = skuParts[1] || 'Unknown';
                    const color = skuParts[2] || 'Unknown';
                    const carrier = skuParts[3] || 'Unlocked';
                    
                    // Build hierarchy structure
                    if (!hierarchy[model]) {
                        hierarchy[model] = {
                            count: 0,
                            storage: {}
                        };
                    }
                    
                    if (!hierarchy[model].storage[storage]) {
                        hierarchy[model].storage[storage] = {
                            count: 0,
                            colors: {}
                        };
                    }
                    
                    if (!hierarchy[model].storage[storage].colors[color]) {
                        hierarchy[model].storage[storage].colors[color] = {
                            count: 0,
                            carriers: {}
                        };
                    }
                    
                    if (!hierarchy[model].storage[storage].colors[color].carriers[carrier]) {
                        hierarchy[model].storage[storage].colors[color].carriers[carrier] = {
                            count: 0,
                            items: []
                        };
                    }
                    
                    // Add item to hierarchy
                    hierarchy[model].count++;
                    hierarchy[model].storage[storage].count++;
                    hierarchy[model].storage[storage].colors[color].count++;
                    hierarchy[model].storage[storage].colors[color].carriers[carrier].count++;
                    hierarchy[model].storage[storage].colors[color].carriers[carrier].items.push(item);
                });
                
                return hierarchy;
            };

            const toggleModel = (model) => {
                const newExpanded = new Set(expandedModels);
                if (newExpanded.has(model)) {
                    newExpanded.delete(model);
                } else {
                    newExpanded.add(model);
                }
                setExpandedModels(newExpanded);
            };

            const toggleStorage = (model, storage) => {
                const key = `${model}-${storage}`;
                const newExpanded = new Set(expandedStorage);
                if (newExpanded.has(key)) {
                    newExpanded.delete(key);
                } else {
                    newExpanded.add(key);
                }
                setExpandedStorage(newExpanded);
            };

            const toggleColor = (model, storage, color) => {
                const key = `${model}-${storage}-${color}`;
                const newExpanded = new Set(expandedColors);
                if (newExpanded.has(key)) {
                    newExpanded.delete(key);
                } else {
                    newExpanded.add(key);
                }
                setExpandedColors(newExpanded);
            };

            const hierarchy = buildHierarchy();

            return (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <h3 className="text-lg font-medium text-gray-900 mb-2">
                            SKU Hierarchy Overview ({inventory.length} total devices)
                        </h3>
                        <p className="text-sm text-gray-500">
                            Click on cards to expand and view detailed breakdowns
                        </p>
                    </div>

                    {Object.keys(hierarchy).length === 0 ? (
                        <div className="bg-white rounded-lg shadow p-8 text-center">
                            <div className="text-gray-400 mb-4">
                                <svg className="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                </svg>
                            </div>
                            <p className="text-gray-500 text-lg">No SKU data available</p>
                            <p className="text-gray-400 text-sm mt-2">Add devices with SKU information to see the hierarchy</p>
                        </div>
                    ) : (
                        <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                            {Object.entries(hierarchy).map(([model, modelData]) => (
                                <div key={model} className="bg-white rounded-lg shadow-lg overflow-hidden">
                                    {/* Model Header */}
                                    <div 
                                        className="bg-gradient-to-r from-blue-500 to-blue-600 p-4 cursor-pointer hover:from-blue-600 hover:to-blue-700 transition-all duration-200"
                                        onClick={() => toggleModel(model)}
                                    >
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h4 className="text-lg font-semibold text-white">{model}</h4>
                                                <p className="text-blue-100 text-sm">{modelData.count} devices</p>
                                            </div>
                                            <div className="text-white">
                                                {expandedModels.has(model) ? (
                                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
                                                    </svg>
                                                ) : (
                                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                                    </svg>
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Storage Options */}
                                    {expandedModels.has(model) && (
                                        <div className="p-4 space-y-4">
                                            {Object.entries(modelData.storage).map(([storage, storageData]) => (
                                                <div key={storage} className="border border-gray-200 rounded-lg overflow-hidden">
                                                    {/* Storage Header */}
                                                    <div 
                                                        className="bg-gray-50 px-4 py-3 cursor-pointer hover:bg-gray-100 transition-colors"
                                                        onClick={() => toggleStorage(model, storage)}
                                                    >
                                                        <div className="flex items-center justify-between">
                                                            <div>
                                                                <h5 className="font-medium text-gray-900">{storage}</h5>
                                                                <p className="text-gray-600 text-sm">{storageData.count} devices</p>
                                                            </div>
                                                            <div className="text-gray-500">
                                                                {expandedStorage.has(`${model}-${storage}`) ? (
                                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
                                                                    </svg>
                                                                ) : (
                                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                                                    </svg>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>

                                                    {/* Color Options */}
                                                    {expandedStorage.has(`${model}-${storage}`) && (
                                                        <div className="border-t border-gray-200">
                                                            {Object.entries(storageData.colors).map(([color, colorData]) => (
                                                                <div key={color} className="border-b border-gray-100 last:border-b-0">
                                                                    {/* Color Header */}
                                                                    <div 
                                                                        className="px-4 py-3 cursor-pointer hover:bg-gray-50 transition-colors"
                                                                        onClick={() => toggleColor(model, storage, color)}
                                                                    >
                                                                        <div className="flex items-center justify-between">
                                                                            <div>
                                                                                <h6 className="font-medium text-gray-800">{color}</h6>
                                                                                <p className="text-gray-600 text-sm">{colorData.count} devices</p>
                                                                            </div>
                                                                            <div className="text-gray-400">
                                                                                {expandedColors.has(`${model}-${storage}-${color}`) ? (
                                                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
                                                                                    </svg>
                                                                                ) : (
                                                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                                                                    </svg>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    {/* Carrier Options */}
                                                                    {expandedColors.has(`${model}-${storage}-${color}`) && (
                                                                        <div className="bg-gray-50 border-t border-gray-200">
                                                                            {Object.entries(colorData.carriers).map(([carrier, carrierData]) => (
                                                                                <div key={carrier} className="px-4 py-3 border-b border-gray-200 last:border-b-0">
                                                                                    <div className="flex items-center justify-between mb-2">
                                                                                        <h7 className="font-medium text-gray-700">{carrier}</h7>
                                                                                        <span className="text-sm text-gray-500">{carrierData.count} devices</span>
                                                                                    </div>
                                                                                    
                                                                                    {/* Individual Devices */}
                                                                                    <div className="space-y-2">
                                                                                        {carrierData.items.map((item, index) => (
                                                                                            <div key={item.id || index} className="bg-white rounded border border-gray-200 p-3">
                                                                                                <div className="flex items-center justify-between mb-1">
                                                                                                    <span className="font-mono text-sm text-gray-900">{item.imei}</span>
                                                                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                                                                        item.working === 'YES' ? 'bg-green-100 text-green-800' :
                                                                                                        item.working === 'NO' ? 'bg-red-100 text-red-800' :
                                                                                                        'bg-yellow-100 text-yellow-800'
                                                                                                    }`}>
                                                                                                        {item.working || 'PENDING'}
                                                                                                    </span>
                                                                                                </div>
                                                                                                <div className="text-xs text-gray-500 space-x-2">
                                                                                                    <span>Battery: {item.batteryHealth || 'N/A'}%</span>
                                                                                                    <span>•</span>
                                                                                                    <span>Condition: {item.condition || 'N/A'}</span>
                                                                                                </div>
                                                                                            </div>
                                                                                        ))}
                                                                                    </div>
                                                                                </div>
                                                                            ))}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // Inventory Manager Component
        const InventoryManager = () => {
            const [inventory, setInventory] = useState([]);
            const [loading, setLoading] = useState(true);
            const [toast, setToast] = useState(null);
            const [activeTab, setActiveTab] = useState('imei'); // 'imei' or 'sku'
            const [searchTerm, setSearchTerm] = useState('');
            const [filterBrand, setFilterBrand] = useState('');
            const [filterCarrier, setFilterCarrier] = useState('');
            const [filterCondition, setFilterCondition] = useState('');
            const [filterWorkingStatus, setFilterWorkingStatus] = useState('');
            const [sortBy, setSortBy] = useState('createdAt');
            const [sortOrder, setSortOrder] = useState('desc');
            const [selectedItems, setSelectedItems] = useState([]);
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [stats, setStats] = useState({
                total: 0,
                brands: {},
                carriers: {},
                conditions: {}
            });

            // Fetch inventory data
            const fetchInventory = async () => {
                try {
                    setLoading(true);
                    const response = await fetch('/api/admin/inventory');
                    if (response.ok) {
                        const data = await response.json();
                        setInventory(data);
                        calculateStats(data);
                    } else {
                        throw new Error('Failed to fetch inventory');
                    }
                } catch (error) {
                    console.error('Error fetching inventory:', error);
                    setToast({ message: 'Failed to load inventory data', type: 'error' });
                } finally {
                    setLoading(false);
                }
            };

            // Calculate statistics
            const calculateStats = (data) => {
                const stats = {
                    total: data.length,
                    brands: {},
                    carriers: {},
                    conditions: {},
                    workingStatus: {
                        YES: 0,
                        NO: 0,
                        PENDING: 0
                    },
                    phonecheckData: {
                        withDefects: 0,
                        withNotes: 0,
                        withCustom1: 0
                    }
                };

                data.forEach(item => {
                    // Brand stats
                    const brand = item.brand || 'Unknown';
                    stats.brands[brand] = (stats.brands[brand] || 0) + 1;

                    // Carrier stats
                    const carrier = item.carrier || 'Unknown';
                    stats.carriers[carrier] = (stats.carriers[carrier] || 0) + 1;

                    // Condition stats
                    const condition = item.condition || 'Unknown';
                    stats.conditions[condition] = (stats.conditions[condition] || 0) + 1;

                    // Working status stats
                    const working = item.working || 'PENDING';
                    stats.workingStatus[working] = (stats.workingStatus[working] || 0) + 1;

                    // PhoneCheck data stats - check both testResults and direct fields
                    const hasPhoneCheckData = item.testResults || item.defects || item.notes || item.custom1;
                    if (hasPhoneCheckData) {
                        if (item.testResults?.defects || item.defects) stats.phonecheckData.withDefects++;
                        if (item.testResults?.notes || item.notes) stats.phonecheckData.withNotes++;
                        if (item.testResults?.custom1 || item.custom1) stats.phonecheckData.withCustom1++;
                    }
                });

                setStats(stats);
            };

            // Filter and sort inventory
            const getFilteredInventory = () => {
                let filtered = [...inventory];

                // Search filter
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    filtered = filtered.filter(item =>
                        item.name?.toLowerCase().includes(term) ||
                        item.model?.toLowerCase().includes(term) ||
                        item.imei?.includes(term) ||
                        item.serialNumber?.toLowerCase().includes(term) ||
                        item.brand?.toLowerCase().includes(term)
                    );
                }

                // Brand filter
                if (filterBrand) {
                    filtered = filtered.filter(item => item.brand === filterBrand);
                }

                // Carrier filter
                if (filterCarrier) {
                    filtered = filtered.filter(item => item.carrier === filterCarrier);
                }

                // Condition filter
                if (filterCondition) {
                    filtered = filtered.filter(item => item.condition === filterCondition);
                }

                // Working status filter
                if (filterWorkingStatus) {
                    filtered = filtered.filter(item => item.working === filterWorkingStatus);
                }

                // Sort
                filtered.sort((a, b) => {
                    let aVal = a[sortBy];
                    let bVal = b[sortBy];

                    if (sortBy === 'createdAt' || sortBy === 'updatedAt') {
                        aVal = new Date(aVal || 0);
                        bVal = new Date(bVal || 0);
                    } else if (typeof aVal === 'string') {
                        aVal = aVal.toLowerCase();
                        bVal = bVal.toLowerCase();
                    }

                    if (sortOrder === 'asc') {
                        return aVal > bVal ? 1 : -1;
                    } else {
                        return aVal < bVal ? 1 : -1;
                    }
                });

                return filtered;
            };

            // Export to CSV
            const exportToCSV = () => {
                const filteredInventory = getFilteredInventory();
                const headers = ['ID', 'Name', 'Brand', 'Model', 'IMEI', 'Serial Number', 'SKU', 'Working Status', 'Condition', 'Battery Health', 'Carrier', 'Storage', 'Color', 'Created At'];
                const csvContent = [
                    headers.join(','),
                    ...filteredInventory.map(item => [
                        item.id,
                        `"${item.name || ''}"`,
                        `"${item.brand || ''}"`,
                        `"${item.model || ''}"`,
                        item.imei || '',
                        `"${item.serialNumber || ''}"`,
                        `"${item.sku || ''}"`,
                        `"${item.working || ''}"`,
                        `"${item.condition || ''}"`,
                        item.batteryHealth || '',
                        `"${item.carrier || ''}"`,
                        `"${item.storage || ''}"`,
                        `"${item.color || ''}"`,
                        item.createdAt || ''
                    ].join(','))
                ].join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `inventory_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                window.URL.revokeObjectURL(url);
                
                setToast({ message: 'Inventory exported to CSV successfully', type: 'success' });
            };

            // Selection handlers
            const selectAll = () => {
                const filteredInventory = getFilteredInventory();
                const filteredIds = filteredInventory.map(item => item.id);
                setSelectedItems(filteredIds);
            };

            const clearSelection = () => {
                setSelectedItems([]);
            };

            // Initialize
            useEffect(() => {
                fetchInventory();
            }, []);

            const filteredInventory = getFilteredInventory();
            const uniqueBrands = [...new Set(inventory.map(item => item.brand).filter(Boolean))];
            const uniqueCarriers = [...new Set(inventory.map(item => item.carrier).filter(Boolean))];
            const uniqueConditions = [...new Set(inventory.map(item => item.condition).filter(Boolean))];
            const uniqueWorkingStatuses = [...new Set(inventory.map(item => item.working).filter(Boolean))];

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="bg-white shadow">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-6">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-900">Inventory Manager</h1>
                                    <p className="mt-1 text-sm text-gray-500">Manage and view your device inventory</p>
                                </div>
                                <div className="flex items-center space-x-4">
                                    {/* Navigation Links */}
                                    <div className="flex space-x-2">
                                        <a
                                            href="/phonecheck.html"
                                            className="px-4 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"
                                        >
                                            Phonecheck
                                        </a>
                                        <a
                                            href="/bulk-add.html"
                                            className="px-4 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"
                                        >
                                            Bulk Add
                                        </a>
                                        <a
                                            href="/inventory-manager.html"
                                            className="px-4 py-2 bg-blue-100 text-blue-700 rounded-md font-medium"
                                        >
                                            Inventory Manager
                                        </a>
                                        <a
                                            href="/admin-dashboard.html"
                                            className="px-4 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"
                                        >
                                            Admin Dashboard
                                        </a>
                                    </div>
                                    <div className="flex space-x-3">
                                        <button
                                            onClick={exportToCSV}
                                            className="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700"
                                        >
                                            Export CSV
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {/* Statistics Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center">
                                    <div className="p-2 bg-blue-100 rounded-lg">
                                        <svg className="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                                        </svg>
                                    </div>
                                    <div className="ml-4">
                                        <p className="text-sm font-medium text-gray-500">Total Items</p>
                                        <p className="text-2xl font-bold text-gray-900">{stats.total}</p>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center">
                                    <div className="p-2 bg-green-100 rounded-lg">
                                        <svg className="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div className="ml-4">
                                        <p className="text-sm font-medium text-gray-500">Passed Tests</p>
                                        <p className="text-2xl font-bold text-gray-900">{stats.workingStatus?.YES || 0}</p>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center">
                                    <div className="p-2 bg-red-100 rounded-lg">
                                        <svg className="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div className="ml-4">
                                        <p className="text-sm font-medium text-gray-500">Failed Tests</p>
                                        <p className="text-2xl font-bold text-gray-900">{stats.workingStatus?.NO || 0}</p>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center">
                                    <div className="p-2 bg-yellow-100 rounded-lg">
                                        <svg className="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div className="ml-4">
                                        <p className="text-sm font-medium text-gray-500">Pending Tests</p>
                                        <p className="text-2xl font-bold text-gray-900">{stats.workingStatus?.PENDING || 0}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Tab Navigation */}
                        <div className="mb-6">
                            <div className="border-b border-gray-200">
                                <nav className="-mb-px flex space-x-8">
                                    <button
                                        onClick={() => setActiveTab('imei')}
                                        className={`py-2 px-1 border-b-2 font-medium text-sm ${
                                            activeTab === 'imei'
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        <svg className="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                        </svg>
                                        IMEI View ({filteredInventory.length})
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('sku')}
                                        className={`py-2 px-1 border-b-2 font-medium text-sm ${
                                            activeTab === 'sku'
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        <svg className="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                        </svg>
                                        SKU Hierarchy View
                                    </button>
                                </nav>
                            </div>
                        </div>

                        {/* IMEI View */}
                        {activeTab === 'imei' && (
                            <>
                                {/* Filters */}
                                <div className="bg-white rounded-lg shadow p-6 mb-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        {/* Search */}
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Search</label>
                                            <input
                                                type="text"
                                                value={searchTerm}
                                                onChange={(e) => setSearchTerm(e.target.value)}
                                                placeholder="Search by name, model, IMEI..."
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>

                                        {/* Brand Filter */}
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Brand</label>
                                            <select
                                                value={filterBrand}
                                                onChange={(e) => setFilterBrand(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="">All Brands</option>
                                                {uniqueBrands.map(brand => (
                                                    <option key={brand} value={brand}>{brand}</option>
                                                ))}
                                            </select>
                                        </div>

                                        {/* Carrier Filter */}
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Carrier</label>
                                            <select
                                                value={filterCarrier}
                                                onChange={(e) => setFilterCarrier(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="">All Carriers</option>
                                                {uniqueCarriers.map(carrier => (
                                                    <option key={carrier} value={carrier}>{carrier}</option>
                                                ))}
                                            </select>
                                        </div>

                                        {/* Sort */}
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Sort By</label>
                                            <select
                                                value={sortBy}
                                                onChange={(e) => setSortBy(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="createdAt">Date Added</option>
                                                <option value="name">Name</option>
                                                <option value="brand">Brand</option>
                                                <option value="model">Model</option>
                                                <option value="imei">IMEI</option>
                                            </select>
                                        </div>
                                    </div>

                                    {/* Sort Order */}
                                    <div className="mt-4 flex items-center space-x-4">
                                        <label className="flex items-center">
                                            <input
                                                type="radio"
                                                checked={sortOrder === 'desc'}
                                                onChange={() => setSortOrder('desc')}
                                                className="mr-2"
                                            />
                                            Descending
                                        </label>
                                        <label className="flex items-center">
                                            <input
                                                type="radio"
                                                checked={sortOrder === 'asc'}
                                                onChange={() => setSortOrder('asc')}
                                                className="mr-2"
                                            />
                                            Ascending
                                        </label>
                                    </div>
                                </div>

                                {/* Bulk Actions */}
                                {selectedItems.length > 0 && (
                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center space-x-4">
                                                <span className="text-sm font-medium text-blue-800">
                                                    {selectedItems.length} item(s) selected
                                                </span>
                                                <button
                                                    onClick={clearSelection}
                                                    className="text-sm text-blue-600 hover:text-blue-800"
                                                >
                                                    Clear selection
                                                </button>
                                            </div>
                                            <button
                                                onClick={() => setShowDeleteModal(true)}
                                                className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700"
                                            >
                                                Delete Selected
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Inventory Table */}
                                <div className="bg-white rounded-lg shadow overflow-hidden">
                                    <div className="px-6 py-4 border-b border-gray-200">
                                        <div className="flex items-center justify-between">
                                            <h3 className="text-lg font-medium text-gray-900">
                                                Inventory ({filteredInventory.length} items)
                                            </h3>
                                            <div className="flex space-x-2">
                                                <button
                                                    onClick={selectAll}
                                                    className="text-sm text-blue-600 hover:text-blue-800"
                                                >
                                                    Select All
                                                </button>
                                                <button
                                                    onClick={fetchInventory}
                                                    className="text-sm text-gray-600 hover:text-gray-800"
                                                >
                                                    Refresh
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    {loading ? (
                                        <div className="p-8 text-center">
                                            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"></div>
                                            <p className="mt-2 text-gray-500">Loading inventory...</p>
                                        </div>
                                    ) : filteredInventory.length === 0 ? (
                                        <div className="p-8 text-center">
                                            <p className="text-gray-500">No items found matching your criteria.</p>
                                        </div>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="min-w-full divide-y divide-gray-200">
                                                <thead className="bg-gray-50">
                                                    <tr>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            <input
                                                                type="checkbox"
                                                                checked={selectedItems.length === filteredInventory.length}
                                                                onChange={(e) => {
                                                                    if (e.target.checked) {
                                                                        selectAll();
                                                                    } else {
                                                                        clearSelection();
                                                                    }
                                                                }}
                                                                className="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                                            />
                                                        </th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Brand</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Model</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">IMEI</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SKU</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Condition</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Battery</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="bg-white divide-y divide-gray-200">
                                                    {filteredInventory.map((item) => (
                                                        <tr key={item.id} className="hover:bg-gray-50">
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={selectedItems.includes(item.id)}
                                                                    onChange={(e) => {
                                                                        if (e.target.checked) {
                                                                            setSelectedItems([...selectedItems, item.id]);
                                                                        } else {
                                                                            setSelectedItems(selectedItems.filter(id => id !== item.id));
                                                                        }
                                                                    }}
                                                                    className="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                                                />
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="text-sm font-medium text-gray-900">{item.name}</div>
                                                                <div className="text-sm text-gray-500">{item.serialNumber}</div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{item.brand}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{item.model}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono">{item.imei}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{item.sku}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                                                    item.working === 'YES' ? 'bg-green-100 text-green-800' :
                                                                    item.working === 'NO' ? 'bg-red-100 text-red-800' :
                                                                    'bg-yellow-100 text-yellow-800'
                                                                }`}>
                                                                    {item.working || 'PENDING'}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{item.condition}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{item.batteryHealth || 'N/A'}%</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                                <button
                                                                    onClick={() => {
                                                                        setEditingItem(item);
                                                                        setShowEditModal(true);
                                                                    }}
                                                                    className="text-blue-600 hover:text-blue-900 mr-3"
                                                                >
                                                                    Edit
                                                                </button>
                                                                <button
                                                                    onClick={() => {
                                                                        setSelectedItems([item.id]);
                                                                        setShowDeleteModal(true);
                                                                    }}
                                                                    className="text-red-600 hover:text-red-900"
                                                                >
                                                                    Delete
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            </>
                        )}

                        {/* SKU View */}
                        {activeTab === 'sku' && (
                            <SKUHierarchy inventory={inventory} />
                        )}

                        {/* Toast */}
                        {toast && (
                            <Toast
                                message={toast.message}
                                type={toast.type}
                                onClose={() => setToast(null)}
                            />
                        )}
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<InventoryManager />, document.getElementById('root'));
    </script>
</body>
</html>
